---
const { items = [] } = Astro.props;
// items: { label: string, src: string, alt: string }[]
---

<div class="image-switcher-container">
    <div class="image-viewport">
        {
            items.map((item, index) => (
                <img
                    src={item.src}
                    alt={item.alt}
                    class={`switcher-img ${index === 0 ? "active" : ""}`}
                    data-index={index}
                />
            ))
        }
    </div>

    <div class="switcher-nav">
        {
            items.map((item, index) => (
                <button
                    class={`switcher-btn ${index === 0 ? "active" : ""}`}
                    data-index={index}
                >
                    {item.label}
                </button>
            ))
        }
    </div>
</div>

<style>
    .image-switcher-container {
        width: 100%;
        margin: 4rem 0;
    }

    .image-viewport {
        position: relative;
        width: 100%;
        aspect-ratio: 16 / 9;
        background: #111;
        border: 1px solid var(--line);
        overflow: hidden;
        border-radius: 8px;
        margin-bottom: 2rem;
    }

    .switcher-img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        opacity: 0;
        transform: scale(1.05); /* Start slightly zoomed for effect */
        transition:
            opacity 0.5s ease,
            transform 0.5s ease;
        z-index: 1;
    }

    .switcher-img.active {
        opacity: 1;
        transform: scale(1);
        z-index: 2;
    }

    .switcher-nav {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
        justify-content: flex-start; /* Or center based on preference */
        border-top: 1px solid var(--line);
        padding-top: 1.5rem;
    }

    .switcher-btn {
        background: none;
        border: none;
        font-family: var(--font-mono);
        font-size: 1rem;
        color: var(--text-dim);
        cursor: pointer;
        padding: 0;
        transition: color 0.3s;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .switcher-btn:hover,
    .switcher-btn.active {
        color: var(--accent);
    }
</style>

<script>
    import { gsap } from "gsap";

    // Initialize logic for every instance of the component on the page
    const switchers = document.querySelectorAll(".image-switcher-container");

    switchers.forEach((container) => {
        const images = container.querySelectorAll(".switcher-img");
        const buttons = container.querySelectorAll(".switcher-btn");
        let currentIndex = 0;

        buttons.forEach((btn, index) => {
            btn.addEventListener("mouseenter", () => {
                if (currentIndex === index) return;

                // Update active button state
                buttons.forEach((b) => b.classList.remove("active"));
                btn.classList.add("active");

                // Animate Images
                const outgoing = images[currentIndex];
                const incoming = images[index];

                // Outgoing: Fade out and move slightly up
                gsap.to(outgoing, {
                    opacity: 0,
                    scale: 1.05,
                    duration: 0.6,
                    ease: "power2.out",
                });

                // Incoming: Fade in and scale down to 1
                gsap.fromTo(
                    incoming,
                    { opacity: 0, scale: 1.05, zIndex: 10 },
                    {
                        opacity: 1,
                        scale: 1,
                        zIndex: 10,
                        duration: 0.6,
                        ease: "power2.out",
                    },
                );

                // Reset z-indexes after animation
                gsap.set(outgoing, { zIndex: 1, delay: 0.6 });

                currentIndex = index;
            });
        });
    });
</script>
